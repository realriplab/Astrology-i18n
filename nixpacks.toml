[phases.setup]
# 强制 Node 23 以适配最新的集成环境
pkgs = ["nodejs_23", "npm"]

[phases.install]
# 直接 npm ci 即可，因为 edgeone 已经在 devDependencies 中
cmds = ["npm ci"]

[phases.build]
# 1. 执行 Astro 构建
# 2. 拷贝 package.json 到 dist（EdgeOne 部署规范要求）
# 3. 执行部署命令，使用环境变量注入
cmds = [
    "npm run build",
    "cp package.json ./dist/",
    "npx edgeone pages deploy ./dist -n $EDGEONE_PROJECT_NAME -t $EDGEONE_API_TOKEN --force"
]

[start]
# 构建成功启动状态监控面板
cmd = "node deploy-wrapper.cjs"
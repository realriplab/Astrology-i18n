---
import type { Lang } from '@/utils/i18n';
import { t } from '@/utils/translations';
import FooterNav from '@/ui/FooterNav.astro';
import { Icon } from 'astro-icon/components';
import { getRelativeLocaleUrl } from 'astro:i18n';
import Github from '@/assets/github.svg';

interface Props {
  lang?: Lang;
  githubUrl?: string;
  rssUrl?: string;
}

const resolvedLang = ((Astro.currentLocale as Lang | undefined) ??
  (Astro.props.lang as Lang | undefined) ??
  'zh') as Lang;

const siteName = t(resolvedLang, 'site.name');

const twitterHandleRaw = t(resolvedLang, 'site.twitter.site') || '';
const twitterHandle = String(twitterHandleRaw).replace(/^@/, '');
const xUrl = twitterHandle ? `https://x.com/${twitterHandle}` : 'https://x.com';
const githubUrl: string =
  (Astro.props.githubUrl as string | undefined) ?? 'https://github.com/idimilabs';

const rssUrl: string =
  (Astro.props.rssUrl as string | undefined) ?? getRelativeLocaleUrl(resolvedLang, '/rss.xml');
---

<footer class="w-full bg-white dark:bg-neutral-950">
  <div class="mx-auto max-w-6xl px-4 py-10 sm:px-6">
    <div class="grid grid-cols-1 gap-8 md:grid-cols-3">
      <div class="md:col-span-1">
        <a
          href={getRelativeLocaleUrl(resolvedLang, '/')}
          class="inline-flex items-center gap-2 text-xl font-semibold tracking-tight text-neutral-900 hover:opacity-90 dark:text-neutral-100"
        >
          <span
            class="bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 bg-clip-text text-xl text-transparent"
          >
            {siteName}
          </span>
        </a>
        <div class="mt-4 flex items-center gap-6 text-sm">
          <a
            href={xUrl}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-1 text-neutral-600 hover:text-neutral-900 dark:text-neutral-300 dark:hover:text-white"
          >
            <span aria-hidden="true"><Icon name="lucide:twitter" class="h-5 w-5" /></span>
            <span class="sr-only">X</span>
          </a>
          <a
            href={githubUrl}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-1 text-neutral-600 hover:text-neutral-900 dark:text-neutral-300 dark:hover:text-white"
          >
            <span aria-hidden="true"><Github class="h-5 w-5" /></span>
            <span class="sr-only">GitHub</span>
          </a>
          <a
            href={rssUrl}
            class="inline-flex items-center gap-1 text-neutral-600 hover:text-neutral-900 dark:text-neutral-300 dark:hover:text-white"
          >
            <span aria-hidden="true"><Icon name="lucide:rss" class="h-5 w-5" /></span>
            <span class="sr-only">RSS</span>
          </a>
        </div>
      </div>

      <FooterNav lang={resolvedLang} />
    </div>

    <div class="mt-10 text-xs text-neutral-500 dark:text-neutral-400">
      <span>
        &copy; {new Date().getFullYear()}
        {siteName}. {t(resolvedLang, 'footer.allRightsReserved')}
      </span>
    </div>
  </div>
</footer>
